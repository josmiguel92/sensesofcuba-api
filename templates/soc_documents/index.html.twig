{% trans_default_domain easyadmin_config('translation_domain') %}
{% extends easyadmin_config('design.templates.layout') %}

{% block title %}Documents{% endblock %}

{% block card_document %}
    <div class="accordion" id="accordion-{{ document.id }}">
        <div class="card" data-id="{{ document.id }}">
        <div class="card-header" id="document-{{ document.id }}">
            <h4>

                {{ document.referenceName }}

                <small style="float: right;right: 4em;position: relative; font-size: .6em">
                    <a class="  action-edit" title="" href="{{ path('soc_document_edit', {'id': document.id}) }}" target="_self">
                    <i class="fa fa-edit"></i>    Edit
                    </a>
                </small>

            </h4>
             <div class="checkbox-switch" data-propertyname="enabled" style="display: block;position: absolute;right: 1em;top: 1em;">
                    <label>
                        <input type="checkbox" {% if document.enabled %}checked=""{% endif %}>
                        <span></span>
                    </label>
            </div>
            {% if document.translatedDocument is not null %}
                <div class="container">

                        {% for doc in document.translatedDocument.getDocuments %}
                            {% if not loop.first %}
                            |
                            {% endif %}
                        <small>
                            <a href="{{ asset('uploads/files/' ~ doc.file.fileName)}}" download="download"><i class="fa fa-download"></i> Download {{ doc.lang }} file</a>
                        </small>
                        {% else %}
                            <small>
                                <span class="text-warning"><i class="fa fa-warning"></i>This document doesn't contain a downloadable file.</span>
                            </small>
                        {% endfor %}
                </div>
            {% endif %}


        </div>


    </div>
    </div>
{% endblock %}

{% block body_class 'page-blank' %}

{% block content %}
    <div class="content">
        <section class="content-header ">
            <div class="d-flex flex-row justify-content-between align-content-center w-100">
                <div class="content-header-title">
                    <h1 class="title">    Documents</h1>
                </div>

                <div class="global-actions">
                    <div class="form-action form-action-search  action-search">
                        <form method="get" action="{{ path('easyadmin') }}">
                            <input type="hidden" name="action" value="search">
                            <input type="hidden" name="entity" value="Documents">
                            <input type="hidden" name="menuIndex" value="3">
                            <input type="hidden" name="submenuIndex" value="-1">
                            <div class="form-group">
                                <div class="form-widget">
                                    <input class="form-control" type="search" name="query" value="" placeholder="Search">
                                </div>
                            </div>
                        </form>
                    </div>


                    <div class="button-action">
                        <a class="btn btn-primary action-new" href="{{ path('soc_document_new') }}" target="_self">
                            Add Document
                        </a>
                    </div>
                </div>
            </div>



        </section>

        <section id="main" class="content-body">

            <div class="container">
                 {% for document in documents %}
                    {{ block('card_document') }}
                {% endfor %}
            </div>






            <form name="delete_form" method="post" action="{{ path('easyadmin') }}?action=delete&amp;entity=Document&amp;id=__id__" id="delete-form" style="display: none"><input type="hidden" name="_method" value="DELETE"><div id="delete_form" style="display: none"><div><button type="submit" id="delete_form_submit" name="delete_form[submit]">Delete</button></div><input type="hidden" id="delete_form__easyadmin_delete_flag" name="delete_form[_easyadmin_delete_flag]" value="1"><input type="hidden" id="delete_form__token" name="delete_form[_token]" value="aaZg0Sl1Gq9j2FD4xDQRDRzl0Q1e1YNvNhq5V291MUQ"></div></form>

            <div id="modal-delete" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <h4>Do you really want to delete this item?</h4>
                            <p>There is no undo for this operation.</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" data-dismiss="modal" class="btn btn-secondary">
                                <span class="btn-label">Cancel</span>
                            </button>

                            <button type="button" data-dismiss="modal" class="btn btn-danger" id="modal-delete-button" formtarget="_self">
                                <span class="btn-label">Delete</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </section>

        <section class="content-footer">


            <div class="list-pagination">
                <div class="list-pagination-counter">
                    <strong>{{ documents | length }}</strong> results
                </div>

{#                <nav class="pager list-pagination-paginator first-page last-page">#}
{#                    <ul class="pagination">#}
{#                        <li class="page-item disabled">#}
{#                            <a class="page-link" href="#">#}
{#                                <i class="fa fa-angle-left mx-1"></i> <span class="btn-label">Previous</span>#}
{#                            </a>#}
{#                        </li>#}

{#                        <li class="page-item disabled">#}
{#                            <a class="page-link" href="#">#}
{#                                <span class="btn-label">Next</span> <i class="fa fa-angle-right mx-1"></i>#}
{#                            </a>#}
{#                        </li>#}
{#                    </ul>#}
{#                </nav>#}
            </div>

        </section>

    </div>

        <script type="text/javascript">
        $(function() {
            const toggles = document.querySelectorAll('.checkbox-switch input[type="checkbox"]');
            for (i = 0; i < toggles.length; i++) {
                toggles[i].addEventListener('change', function () {
                    const toggle = this;
                    const newValue = this.checked;
                    const oldValue = !newValue;
                    const propertyName = this.closest('.checkbox-switch').dataset.propertyname;

                    const toggleUrl = "{{ path('easyadmin') }}?action=edit&entity=Document&view=list"
                        + "&id=" + this.closest('div.card').dataset.id
                        + "&property=" + propertyName
                        + "&newValue=" + newValue.toString();

                    let toggleRequest = $.ajax({ type: "GET", url: toggleUrl, data: {} });

                    toggleRequest.done(function(result) {});

                    toggleRequest.fail(function() {
                        // in case of error, restore the original value and disable the toggle
                        toggle.checked = oldValue;
                        toggle.disabled = true;
                        toggle.closest('.checkbox-switch').classList.add('disabled');
                    });
                });
            }


                    });
    </script>
        <script src="{{ asset('bundles/vendor/bootstrap-treeview.js') }}"></script>
    <style>
        .nested{
            display: none;
        }
        .active{
            display: block;
        }
        .caret::before{
            content: "\25B6";
            color: black;
            display: inline-block;
            margin-right: 6px;
        }
        .caret-down::before{
            transform: rotate(90deg);
        }

    </style>

    <script>
        var toggler = document.getElementsByClassName("caret");
        var i;

        for(i = 0; i < toggler.length; i++){
            toggler[i].addEventListener("click", function () {
                this.parentElement.querySelector(".nested").classList.toggle("active");
                this.classList.toggle("caret-down")
            })
        }
    </script>

{% endblock %}
